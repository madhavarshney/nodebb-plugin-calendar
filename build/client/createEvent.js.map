{"version":3,"sources":["../../src/client/createEvent.js"],"names":["defaultEvent","name","allday","startDate","Date","now","endDate","reminders","location","description","mandatory","repeats","formats","timeDate","date","createEventFactory","modal","$","backdrop","show","inputs","find","repetition","repeatEndDate","on","format","prop","data","setInputs","event","val","setReminders","setRepeat","getInputs","trim","valueOf","getReminders","getRepeat","s","e","setHours","alertFailure","input","closest","addClass","createEvent","callback","Object","assign","removeClass","submit","del","onClick","newEvent","failed","failures","map","failure","forEach","off","one","onChange"],"mappings":"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","file":"createEvent.js","sourcesContent":["import moment from 'moment';\r\nimport remindersFactory from './reminders';\r\nimport repetitionFactory from './repetition';\r\nimport validateEvent from '../lib/validateEvent';\r\n\r\nconst defaultEvent = {\r\n  name: '',\r\n  allday: false,\r\n  startDate: Date.now(),\r\n  endDate: Date.now() + (1000 * 60 * 60),\r\n  reminders: [],\r\n  location: '',\r\n  description: '',\r\n  mandatory: false,\r\n  repeats: null,\r\n};\r\n\r\nconst formats = {\r\n  timeDate: 'L LT',\r\n  date: 'L',\r\n};\r\n\r\nconst createEventFactory = () => {\r\n  const modal = $('#plugin-calendar-event-editor').modal({\r\n    backdrop: false,\r\n    show: false,\r\n  });\r\n  const inputs = {\r\n    name: modal.find('#plugin-calendar-event-editor-name'),\r\n    allday: modal.find('#plugin-calendar-event-editor-allday'),\r\n    startDate: modal.find('#plugin-calendar-event-editor-startDate'),\r\n    endDate: modal.find('#plugin-calendar-event-editor-endDate'),\r\n    reminders: modal.find('#plugin-calendar-event-editor-reminders'),\r\n    location: modal.find('#plugin-calendar-event-editor-location'),\r\n    description: modal.find('#plugin-calendar-event-editor-description'),\r\n    mandatory: modal.find('#plugin-calendar-event-editor-mandatory'),\r\n    repetition: modal.find('#plugin-calendar-event-editor-repetition'),\r\n    repeatEndDate: modal.find('#plugin-calendar-event-editor-repetition-endDate'),\r\n  };\r\n  const reminders = remindersFactory(inputs.reminders);\r\n  const repetition = repetitionFactory(inputs.repetition);\r\n\r\n  inputs.allday.on('change', () => {\r\n    const format = inputs.allday.prop('checked') ? formats.date : formats.timeDate;\r\n    inputs.startDate.data('DateTimePicker').format(format);\r\n    inputs.endDate.data('DateTimePicker').format(format);\r\n  });\r\n\r\n  const setInputs = (event) => {\r\n    inputs.name.val(event.name);\r\n    inputs.allday.prop('checked', event.allday);\r\n    inputs.startDate.data('DateTimePicker').date(moment(event.startDate));\r\n    inputs.endDate.data('DateTimePicker').date(moment(event.endDate));\r\n    reminders.setReminders(event.reminders);\r\n    repetition.setRepeat(event.repeats);\r\n    inputs.location.val(event.location);\r\n    inputs.description.val(event.description);\r\n    inputs.mandatory.prop('checked', event.mandatory);\r\n\r\n    const format = event.allday ? formats.date : formats.timeDate;\r\n    inputs.startDate.data('DateTimePicker').format(format);\r\n    inputs.endDate.data('DateTimePicker').format(format);\r\n  };\r\n  const getInputs = () => {\r\n    const event = {\r\n      name: inputs.name.val().trim(),\r\n      allday: inputs.allday.prop('checked'),\r\n      startDate: inputs.startDate.data('DateTimePicker').date().valueOf(),\r\n      endDate: inputs.endDate.data('DateTimePicker').date().valueOf(),\r\n      reminders: reminders.getReminders(),\r\n      repeats: repetition.getRepeat(),\r\n      location: inputs.location.val().trim(),\r\n      description: inputs.description.val().trim(),\r\n      mandatory: inputs.mandatory.prop('checked'),\r\n    };\r\n\r\n    if (event.allday) {\r\n      const s = new Date(event.startDate);\r\n      const e = new Date(event.endDate);\r\n\r\n      s.setHours(0, 0, 0, 0);\r\n      e.setHours(23, 59, 59, 999);\r\n\r\n      event.startDate = s.valueOf();\r\n      event.endDate = e.valueOf();\r\n    }\r\n\r\n    return event;\r\n  };\r\n\r\n  const alertFailure = (input) => {\r\n    input.closest('.form-group').addClass('has-error');\r\n  };\r\n\r\n  const createEvent = (data, callback) => {\r\n    const event = Object.assign({}, defaultEvent, data);\r\n    setInputs(event);\r\n    modal.find('.form-group').removeClass('has-error');\r\n    modal.modal('show');\r\n\r\n    const submit = modal.find('#plugin-calendar-event-editor-submit');\r\n    const del = modal.find('#plugin-calendar-event-editor-delete');\r\n\r\n    const onClick = () => {\r\n      const newEvent = getInputs();\r\n      modal.find('.form-group').removeClass('has-error');\r\n\r\n      const [failed, failures] = validateEvent(newEvent);\r\n      if (failed) {\r\n        failures.map(failure => inputs[failure]).forEach(alertFailure);\r\n        return;\r\n      }\r\n\r\n      modal.modal('hide');\r\n      submit.off('click', onClick);\r\n      callback(newEvent);\r\n    };\r\n\r\n    submit.on('click', onClick);\r\n\r\n    del.one('click', () => {\r\n      modal.modal('hide');\r\n      submit.off('click', onClick);\r\n      callback(null);\r\n    });\r\n\r\n    const onChange = () => {\r\n      const newEvent = getInputs();\r\n      modal.find('.form-group').removeClass('has-error');\r\n\r\n      const [failed, failures] = validateEvent(newEvent);\r\n      if (failed) {\r\n        failures.map(failure => inputs[failure]).forEach(alertFailure);\r\n      }\r\n    };\r\n    modal.on('change dp.change', onChange);\r\n  };\r\n\r\n  return createEvent;\r\n};\r\n\r\nexport default createEventFactory;\r\n"]}