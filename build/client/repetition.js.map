{"version":3,"sources":["../../src/client/repetition.js"],"names":["factory","$ul","list","find","click","e","stopPropagation","custom","$","changeButton","changeButtonText","daysOfWeek","customEnd","endDate","data","format","date","add","widgetPositioning","vertical","horizontal","change","elem","value","val","html","siblings","slideDown","slideUp","preventDefault","target","toggleClass","dropdown","forever","toggle","methods","setRepeat","repeat","prop","key","x","every","removeClass","forEach","day","addClass","Number","isFinite","getRepeat","selected","days","parent","map","parseInt","dataset","end","valueOf"],"mappings":"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","file":"repetition.js","sourcesContent":["import moment from 'moment';\r\n\r\nconst factory = ($ul) => {\r\n  const list = $ul\r\n    .find('#plugin-calendar-event-editor-repetition-change > ul');\r\n  list.find('li[data-value=custom] > div').click((e) => {\r\n    e.stopPropagation();\r\n  });\r\n\r\n  const custom = $('#plugin-calendar-event-editor-repetition-custom');\r\n  const changeButton = $('#plugin-calendar-event-editor-repetition-change-button');\r\n  const changeButtonText = changeButton.find('.text');\r\n  const daysOfWeek = $('#plugin-calendar-event-editor-repetition-custom-daysOfWeek');\r\n  const customEnd = custom.find('.plugin-calendar-event-editor-repetition-custom-end');\r\n  const endDate = $('#plugin-calendar-event-editor-repetition-endDate');\r\n\r\n  endDate.data('DateTimePicker')\r\n    .format('L')\r\n    .date(moment().add(7, 'day'))\r\n    .widgetPositioning({\r\n      vertical: 'top',\r\n      horizontal: 'left',\r\n    });\r\n\r\n  list.change(() => {\r\n    const elem = list.find('input[name=repetition-select]:checked');\r\n    const value = elem.val();\r\n\r\n    changeButtonText.html(elem.siblings('span').html());\r\n\r\n    if (value === 'custom') {\r\n      custom.slideDown(200);\r\n    } else {\r\n      custom.slideUp(200);\r\n    }\r\n  });\r\n\r\n  $('#plugin-calendar-event-editor-repetition-custom-daysOfWeek > ul > li > a').click((e) => {\r\n    e.preventDefault();\r\n    $(e.target).toggleClass('active');\r\n  });\r\n\r\n  custom.find('.btn.btn-primary').click(() => {\r\n    changeButton.dropdown('toggle');\r\n  });\r\n\r\n  customEnd.change(() => {\r\n    const forever = customEnd\r\n      .find('[name=repetition-end]:checked')\r\n      .val() === 'forever';\r\n    endDate.toggle(!forever);\r\n  });\r\n\r\n  const methods = {\r\n    setRepeat: (repeat) => {\r\n      if (!repeat) {\r\n        const elem = list\r\n          .find('[name=\"repetition-select\"][value=\"no-repeat\"]')\r\n          .prop('checked', true);\r\n        changeButtonText.html(elem.siblings('span').html());\r\n        return;\r\n      }\r\n\r\n      const key = ['day', 'week', 'month', 'year']\r\n        .find(x => repeat.every[x]);\r\n      custom.toggle(!key);\r\n      if (key) {\r\n        const elem = list\r\n          .find(`[name=\"repetition-select\"][value=\"${key}\"]`)\r\n          .prop('checked', true);\r\n        changeButtonText.html(elem.siblings('span').html());\r\n        return;\r\n      }\r\n\r\n      const elem = list\r\n        .find('[name=\"repetition-select\"][value=\"custom\"]')\r\n        .prop('checked', true);\r\n      changeButtonText.html(elem.siblings('span').html());\r\n\r\n      if (repeat.every.daysOfWeek) {\r\n        daysOfWeek\r\n          .find('li > a')\r\n          .removeClass('active');\r\n        repeat.every.daysOfWeek.forEach((day) => {\r\n          daysOfWeek\r\n            .find(`li[data-value=${day}] > a`)\r\n            .addClass('active');\r\n        });\r\n        const forever = !Number.isFinite(repeat.endDate);\r\n        customEnd\r\n          .find(`[name=repetition-end][value=${forever ? 'forever' : 'end'}]`)\r\n          .prop('checked', true);\r\n        endDate.toggle(!forever);\r\n        if (!forever) {\r\n          endDate.data('DateTimePicker').date(moment(repeat.endDate));\r\n        }\r\n      }\r\n    },\r\n    getRepeat: () => {\r\n      const value = list.find('[name=repetition-select]:checked').val();\r\n      if (value === 'no-repeat') {\r\n        return null;\r\n      }\r\n      if (value !== 'custom') {\r\n        return {\r\n          every: {\r\n            [value]: true,\r\n          },\r\n          endDate: null,\r\n        };\r\n      }\r\n\r\n      const selected = 'weekly';\r\n      if (selected === 'weekly') {\r\n        const days = [...daysOfWeek.find('li > a.active').parent()]\r\n          .map(elem => parseInt(elem.dataset.value, 10));\r\n        const forever = customEnd\r\n          .find('[name=repetition-end]:checked')\r\n          .val() === 'forever';\r\n        if (forever) {\r\n          return {\r\n            every: {\r\n              daysOfWeek: days,\r\n            },\r\n            endDate: null,\r\n          };\r\n        }\r\n        const end = endDate\r\n          .data('DateTimePicker')\r\n          .date()\r\n          .valueOf();\r\n        return {\r\n          every: {\r\n            daysOfWeek: days,\r\n          },\r\n          endDate: end,\r\n        };\r\n      }\r\n\r\n      return {};\r\n    },\r\n  };\r\n\r\n  return methods;\r\n};\r\n\r\nexport default factory;\r\n"]}